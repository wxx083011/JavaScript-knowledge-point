<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,user-scalable=no" />
		<title>0728</title>
		<link href="css/index.css" rel="stylesheet"/>
		<script type="text/javascript">
			setRem();
			window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", function() {
		        setRem();
	    	}, false); 
			
			function setRem() {
				var html = document.querySelector("html");
				var width = html.getBoundingClientRect().width;
				html.style.fontSize = width / 16 + "px";
			}
		</script>
	</head>
	<body>
		<section id="wrap">
			<!--音悦台头部-->
			<header id="header">
				<!--logo 按钮区-->
				<div class="headerT">
					<!--logo-->
					<h1 id="logo">
						<a href="#">
							<img src="img/logo.png" />
						</a>
					</h1>
					<!--菜单按钮-->
					<a href="#" id="menuBtn" class="menuBtnClos"></a>
					<!--按钮排-->
					<div id="btns">
						<a href="#" class="searchBtn">搜索</a>
						<a href="#">登陆</a>
						<a href="#">注册</a>
					</div>
				</div>
				
				<!--搜索区-->
				<form class="search">
					<input type="text" placeholder="请输入搜索内容">
					<input type="submit" value="搜索">
				</form>
				
				<!--菜单列表-->
				<ul id="nav">
					<li>
			            <a href="javascript:void(0);" class="" data-tab="index">首页</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" data-tab="mv" class="">MV</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" data-tab="pl" class="">悦单</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" data-tab="vchart" class="">V榜</a>
			        </li>
				    <li><a href="javascript:void(0);" class="">音悦stage</a></li>
			        <li>
			            <a href="javascript:void(0);" data-tab="wapfan" class="">商城</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" data-tab="program" class="">节目</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" data-tab="stage" class="">饭团</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" data-tab="apps/mobile" class="">资讯</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" target="_blank" class="">我的家</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" target="_blank" class="selected">APP下载</a>
			        </li>
			        <li>
			            <a href="javascript:void(0);" data-tab="apps" class="">热门应用</a>
			        </li>
				</ul>
			</header>
			<!--音悦台内容区-->
			<section class="content">
					<!--可拖拽导航-->
					<nav id="navScroll">
						<ul id="navs">
							<li class="active">
					            <a href="javascript:void(0);" class="" data-tab="index">首页</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" data-tab="mv" class="">MV</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" data-tab="pl" class="">悦单</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" data-tab="vchart" class="">V榜</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" data-tab="vchart" class="">商城</a>
					        </li>
						    <li>
						    	<a href="javascript:void(0);" class="">众筹</a>
						    </li>
					        <li>
					            <a href="javascript:void(0);" data-tab="wapfan" class="">饭团</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" data-tab="program" class="">节目</a>
					       	</li>
					       <li>
					            <a href="javascript:void(0);" data-tab="stage" class="">音悦stage</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" data-tab="apps/mobile" class="">APP下载</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" target="_blank" class="">资讯</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" target="_blank" class="selected">我的家</a>
					        </li>
					        <li>
					            <a href="javascript:void(0);" data-tab="apps" class="">热门应用</a>
					        </li>
						</ul>
					</nav>
			</section>
		</section>
	</body>
	<script src="js/transform.js"></script>
	<script type="text/javascript">
		CMFCMenuBar(); 
		dragNav();
		
	
		//菜单切换
		function CMFCMenuBar() {
			var btn =document.querySelector("#menuBtn");
			var nav =document.querySelector("#nav");
			
			btn.addEventListener(
//				"touchend", 不可以是touchend,与冒泡到document的touchstart有关
				"touchstart",
				function(e){
					if(this.className=="menuBtnClos"){
						btn.className = "menuBtnShow";
						nav.style.display = "block";
					}else {
						btn.className = "menuBtnClos";
						nav.style.display = "none";
					}
					e.stopPropagation();
				}
			);
			
//			防止事件点透,提高用户体验
			nav.addEventListener("touchstart", function(e) {
				e.stopPropagation();
			});
			
			
			document.addEventListener(
//				为什么选用touchstart,为了提高用户在滑屏时的体验
				"touchstart",
				function(){
					if(btn.className == "menuBtnShow"){
						btn.className = "menuBtnClos";
						nav.style.display = "none";
					}
				}
			);
			
		}
			
		//可拖拽的导航
		function dragNav(){
			var navScroll =document.querySelector("#navScroll");
			var navs =document.querySelector("#navs");
			var startpoint = 0;
			var startX=0;
			
			//限定拖拽范围
			var minX = navScroll.clientWidth - navs.offsetWidth;
			//拉力系数
			var step = 1;
			
			var lastX = 0; //上次的距离
			var lastTime = 0;//上次的时间戳
			var lastDis = 0;
			var lastTimeDis = 0;
			navScroll.addEventListener(
				"touchstart",
				function(e){
					
					navs.style.transition = "none";
					
					startpoint =e.changedTouches[0].pageX;
					startX = cssTransform(navs,"translateX");
					step = 1;
					
					lastX = startX;
					lastTime = new Date().getTime();
					lastDis = 0;
					lastTimeDis = 0;
				}
			);
			
			navScroll.addEventListener(
				"touchmove",
				function(e){
					var nowpoint =e.changedTouches[0].pageX;
					var dis = nowpoint-startpoint;
					var left = startX+dis;
					
					var nowTime = new Date().getTime();
					
					if(left>0){
						step = 1-(left / navScroll.clientWidth); 
						left = parseInt(left*step);
					}
					if(left<minX){
						var overRight = minX - left;
						step= 1-(overRight / navScroll.clientWidth); 
						overRight = parseInt(overRight*step);
						left = minX - overRight;
					}
					
					lastDis = left-lastX; //距离差值
					lastTimeDis = nowTime - lastTime; //时间差值
//					console.log("time:"+lastTimeDis,"----dis:"+lastDis);
					lastX = left;
					lastTime = nowTime;
					
					cssTransform(navs,"translateX",left);
				}
			);
			
			navScroll.addEventListener(
				'touchend', 
				function (){
					var speed = (lastDis/lastTimeDis)*300; //用距离差值/时间差值 = 速度   速度*系数 = 缓冲距离
					var left = cssTransform(navs,"translateX");
					var target = left + speed; //当前值 + 缓冲距离 = 目标点
					var type = "cubic-bezier(.34,.92,.58,.9)";
					var time = Math.abs(speed*.9);
					time = time<300?300:time;
					if(target > 0) {
						target = 0;
						type ="cubic-bezier(.08,1.44,.6,1.46)";
					}
					if(target < minX) {
						target = minX;
						type ="cubic-bezier(.08,1.44,.6,1.46)";
					}
					navs.style.transition = time+"ms " + type;
					cssTransform(navs,"translateX",target);
				}
			);
			
		}
	</script>
</html>
